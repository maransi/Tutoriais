<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Cadastro de Investidores</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

  <!-- Toastr CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">

  <style>
    label { font-weight: bold; }
    .dataTables_wrapper {
      margin-left: 1rem;
      margin-right: 1rem;
    }
  </style>
</head>
<body class="container-fluid py-4 px-5">
    <div class="col-12 justify-content-center">
        <!-- Caixa de Filtros -->
        <div class="card mb-2 col-12 col-lg-12">
            <div class="card-header bg-primary text-white">Filtros de Pesquisa</div>
            <div class="card-body">
                <form id="form-filtro" class="row g-3 align-items-end">
                    <div class="col-md-2">
                        <label for="filtro-cpf">CPF do Investidor</label>
                        <input type="text" id="filtro-cpf" name="filtro-cpf" class="form-control">
                    </div>
                    <div class="col-md-4">
                        <label for="filtro-nome">Nome</label>
                        <input type="text" id="filtro-nome" name="filtro-nome" class="form-control">
                    </div>
                    <div class="col-md-2">
                        <label for="filtro-usuario">Usuário</label>
                        <input type="text" id="filtro-usuario" name="filtro-usuario" class="form-control">
                    </div>
                    <div class="col-md-4 d-flex flex-wrap gap-2">
                        <button type="button" id="btnPesquisar" class="btn btn-secondary">Pesquisar</button>
                        <button type="button" id="btnNovo" class="btn btn-secondary">Novo</button>
                        <button type="reset" id="btnLimpar" class="btn btn-secondary">Limpar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Caixa da Tabela Investidores -->
        <div class="card col-12 col-lg-12">
            <div class="card-header bg-primary text-white">Lista de Investidores</div>
            <div class="card-body">
                <table id="tabela-investidores" class="display table table-striped" style="width:100%">
                    <thead>
                        <tr>
                            <th>CPF</th>
                            <th>Nome</th>
                            <th>Usuário</th>
                            <th>Total das Carteiras</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal Investidor -->
    <div class="modal fade" id="modalInvestidor" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <form id="form-investidor" class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Cadastro de Investidor</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <!-- Card -->
            <div class="card">
              <div class="card-header bg-primary text-white">Informações do Investidor</div>
              <div class="card-body">
                <div class="mb-3">
                  <label for="cpf">CPF</label>
                  <input type="text" id="cpf" name="cpf" class="form-control" required>
                </div>
                <div class="mb-3">
                  <label for="nome">Nome</label>
                  <input type="text" id="nome" name="nome" class="form-control" required>
                </div>
                <div class="mb-3">
                  <label for="usuario">Usuário</label>
                  <input type="text" id="usuario" name="usuario" class="form-control" required>
                </div>
                <div class="mb-3">
                  <label for="total_carteiras">Total das Carteiras</label>
                  <input type="text" id="total_carteiras" name="total_carteiras" class="form-control" required>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Salvar</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Contas -->
    <div class="modal fade" id="modalContas" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-body">
            <!-- Card -->
            <div class="card">
              <div class="card-header bg-primary text-white">Lista de Contas</div>
              <div class="card-body">
                <table id="tabela-contas" class="display table table-striped" style="width:100%">
                  <thead>
                    <tr>
                      <th>Apelido</th>
                      <th>Banco</th>
                      <th>Agência</th>
                      <th>Número da Conta</th>
                      <th>Ações</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" id="btnNovaConta" class="btn btn-primary">Nova</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Cadastro Conta -->
    <div class="modal fade" id="modalContaForm" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <form id="form-conta" class="modal-content">
          <div class="modal-body">
            <!-- Card -->
            <div class="card">
              <div class="card-header bg-primary text-white">Informações da Conta</div>
              <div class="card-body">
                <div class="mb-3">
                  <label for="apelido">Apelido</label>
                  <input type="text" id="apelido" name="apelido" class="form-control" required>
                </div>
                <div class="mb-3">
                  <label for="banco">Banco</label>
                  <input type="text" id="banco" name="banco" class="form-control" required>
                </div>
                <div class="mb-3">
                  <label for="agencia">Agência</label>
                  <input type="text" id="agencia" name="agencia" class="form-control" required>
                </div>
                <div class="mb-3">
                  <label for="numero_conta">Número da Conta</label>
                  <input type="text" id="numero_conta" name="numero_conta" class="form-control" required>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Salvar</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- JS -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-maskmoney/3.0.2/jquery.maskMoney.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

    <script>
      $(document).ready(function() {
        $("#filtro-cpf, #cpf").mask("000.000.000-00");
        $("#total_carteiras").maskMoney({ prefix: "", decimal: ",", thousands: "." });

        toastr.options = { positionClass: "toast-bottom-right", timeOut: 2500 };

        // DataTable Investidores
        var tabela = $("#tabela-investidores").DataTable({
          searching: false,
          language: {
            lengthMenu: "Mostrar _MENU_ registros por página",
            zeroRecords: "Nenhum registro encontrado",
            info: "Mostrando página _PAGE_ de _PAGES_",
            infoEmpty: "Nenhum registro disponível",
            paginate: {
              first: "Primeira", last: "Última",
              next: "Próxima", previous: "Anterior"
            }
          }
        });

        // DataTable Contas
        var tabelaContas = $("#tabela-contas").DataTable({
          searching: false,
          paging: false,
          info: false,
          language: { zeroRecords: "Nenhuma conta encontrada" }
        });

        // Dados fictícios de contas
        var contasFicticias = [
          ["Conta Principal", "Banco do Brasil", "1234", "56789-0"],
          ["Poupança", "Caixa", "5678", "12345-6"],
          ["Investimentos", "Itaú", "1010", "98765-4"],
          ["Conta Corrente", "Bradesco", "2222", "33333-3"],
          ["Reserva", "Santander", "7777", "44444-4"],
        ];

        // Exibir investidores fictícios
        $("#btnPesquisar").click(function() {
          tabela.clear().draw();
          tabela.row.add([
            "123.456.789-00", "João da Silva", "joaosilva", "10.000,00",
            `<button class="btn btn-sm btn-warning btn-editar">✏️</button>
             <button class="btn btn-sm btn-danger btn-excluir">🗑️</button>
             <button class="btn btn-sm btn-info btn-contas">💳 Contas</button>`
          ]).draw();
          toastr.success("Dados carregados com sucesso!");
        });

        // Abrir modal contas
        $("#tabela-investidores").on("click", ".btn-contas", function() {
          tabelaContas.clear().draw();
          contasFicticias.forEach(c => {
            tabelaContas.row.add([
              c[0], c[1], c[2], c[3],
              `<button class="btn btn-sm btn-warning btn-editar-conta">✏️</button>
               <button class="btn btn-sm btn-danger btn-excluir-conta">🗑️</button>`
            ]);
          });
          tabelaContas.draw();
          $("#modalContas").modal("show");
        });

        // Nova Conta
        $("#btnNovaConta").click(function() {
          $("#form-conta")[0].reset();
          $("#modalContaForm").data("rowIndex", null);
          $("#modalContaForm").modal("show");
        });

        // Editar Conta
        $("#tabela-contas").on("click", ".btn-editar-conta", function() {
          var row = tabelaContas.row($(this).parents("tr"));
          var data = row.data();
          $("#apelido").val(data[0]);
          $("#banco").val(data[1]);
          $("#agencia").val(data[2]);
          $("#numero_conta").val(data[3]);
          $("#modalContaForm").data("rowIndex", row.index());
          $("#modalContaForm").modal("show");
        });

        // Excluir Conta
        $("#tabela-contas").on("click", ".btn-excluir-conta", function() {
          if (confirm("Deseja realmente excluir esta conta?")) {
            tabelaContas.row($(this).parents("tr")).remove().draw();
            toastr.warning("Conta excluída.");
          }
        });

        // Salvar Conta
        $("#form-conta").validate({
          submitHandler: function(form) {
            var apelido = $("#apelido").val();
            var banco = $("#banco").val();
            var agencia = $("#agencia").val();
            var numero = $("#numero_conta").val();
            var rowIndex = $("#modalContaForm").data("rowIndex");

            var rowData = [
              apelido, banco, agencia, numero,
              `<button class="btn btn-sm btn-warning btn-editar-conta">✏️</button>
               <button class="btn btn-sm btn-danger btn-excluir-conta">🗑️</button>`
            ];

            if (rowIndex !== null) {
              tabelaContas.row(rowIndex).data(rowData).draw();
              toastr.success("Conta atualizada com sucesso!");
            } else {
              tabelaContas.row.add(rowData).draw();
              toastr.success("Conta adicionada com sucesso!");
            }

            $("#modalContaForm").modal("hide");
            return false;
          }
        });

        // Novo Investidor
        $("#btnNovo").click(function() {
          $("#form-investidor")[0].reset();
          $("#modalInvestidor").modal("show");
        });

        // Editar Investidor
        $("#tabela-investidores").on("click", ".btn-editar", function() {
          var data = tabela.row($(this).parents("tr")).data();
          $("#cpf").val(data[0]);
          $("#nome").val(data[1]);
          $("#usuario").val(data[2]);
          $("#total_carteiras").val(data[3]);
          $("#modalInvestidor").modal("show");
        });

        // Excluir Investidor
        $("#tabela-investidores").on("click", ".btn-excluir", function() {
          if (confirm("Deseja realmente excluir este investidor?")) {
            tabela.row($(this).parents("tr")).remove().draw();
            toastr.warning("Investidor excluído.");
          }
        });

        // Validar formulário Investidor
        $("#form-investidor").validate({
          submitHandler: function(form) {
            toastr.success("Investidor salvo com sucesso!");
            $("#modalInvestidor").modal("hide");
            return false;
          }
        });
      });
    </script>
</body>
</html>
