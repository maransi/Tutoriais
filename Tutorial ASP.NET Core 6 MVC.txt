Tutorial ASP.NET Core 6 MVC
---------------------------

. Na pasta raiz do projeto execute o comando abaixo:

    dotnet new web -o bethanysPieShop -n bethanysPieShop -f net6.0

    dotnet clean

    dotnet restore

    dotnet build

    dotnet run

 
. Acesse a classe "Program.cs" do seu projeto e acrescente as linhas abaixo:

        var builder = WebAppication.CreateBuilder(args);

        builder.Services.AddControllersWithViews();              // Linha inserida

        var app = builder.Build();

        app.UseStaticFiles();                                   // Linha inserida

        if ( app.Environment.IsDevelopment() )                  // If inserido
        {
            app.UseDeveloperExceptionPage();                        
        }

        app.MapDefaultControllerRoute();                        // Linha inserida

        app.MapGet("/", () => "Hello World!");

        app.Run();  


. Crie na estrutura raiz do projeto a pasta "Models" e crie as classes abaixo:

    namespace bethanysPieShop.Models;

    public class Category
    {
        public int CategoryId { get; set; }

        public string CategoryName { get; set; } = string.Empty;

        public string? Description { get; set; }

        public List<Pie>? Pies { get; set; }
    }






    namespace bethanysPieShop.Models;

    public class Pie
    {
        public int PieId { get; set; }

        public string Name { get; set; } = string.Empty;

        public string? ShortDescription
        {
            get; set;
        }

        public string? LongDescription
        {
            get; set;
        }

        public string? AllergyInformation { get; set; }

        public decimal Price { get; set; }

        public string? ImageUrl { get; set; }

        public string? ImageThumbnailUrl { get; set; }

        public bool IsPieOfTheWeek { get; set; }

        public int CategoryId { get; set; }

        // public Category Category { get; set; }

        public bool InStock
        {
            get; set;
        }

        public Category Category
        {
            get; set;
        } = default!;
    }


. Crie as classes e interfaces abaixo na mesma pasta "Models":

    namespace bethanysPieShop.Models;

    public interface IPieRepository
    {
        IEnumerable<Pie> AllPies { get; }

        IEnumerable<Pie> PiesOfTheWeek{ get; }

        Pie? GetPieById( int pieId );
    }




    namespace bethanysPieShop.Models;

    public interface ICategoryRepository
    {
        IEnumerable<Category> AllCategories{ get; }
    }


. Crie a classe de implementação "MockCategoryRepository" dentro da pasta Models:

    namespace bethanysPieShop.Models;

    public class MockCategoryRepository : ICategoryRepository
    {
        public IEnumerable<Category> AllCategories => new List<Category>{
                        new Category{ CategoryId = 1, CategoryName = "Fruit pies", Description = "All fruity pies"},
                        new Category{ CategoryId = 2, CategoryName = "Cheese cakes", Description = "Cheesy all the way"},
                        new Category{ CategoryId = 3, CategoryName = "Seasonal pies", Description = "Get in the mood for a seasonal pie"}
                    };
    }



    namespace bethanysPieShop.Models;

    public class MockPieRepository : IPieRepository
    {

        private readonly ICategoryRepository _categoryRepository = new MockCategoryRepository();

        public IEnumerable<Pie> AllPies =>
            new List<Pie>
            {
                new Pie {PieId = 1, Name="Strawberry Pie", Price=15.95M, ShortDescription="Lorem Ipsum", LongDescription="Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = _categoryRepository.AllCategories.ToList()[0],ImageUrl="https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/fruitpies/strawberrypie.jpg", InStock=true, IsPieOfTheWeek=false, ImageThumbnailUrl="https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/fruitpies/strawberrypiesmall.jpg"},
                new Pie {PieId = 2, Name="Cheese cake", Price=18.95M, ShortDescription="Lorem Ipsum", LongDescription="Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = _categoryRepository.AllCategories.ToList()[1],ImageUrl="https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/cheesecakes/cheesecake.jpg", InStock=true, IsPieOfTheWeek=false, ImageThumbnailUrl="https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/cheesecakes/cheesecakesmall.jpg"},
                new Pie {PieId = 3, Name="Rhubarb Pie", Price=15.95M, ShortDescription="Lorem Ipsum", LongDescription="Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = _categoryRepository.AllCategories.ToList()[0],ImageUrl="https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/fruitpies/rhubarbpie.jpg", InStock=true, IsPieOfTheWeek=true, ImageThumbnailUrl="https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/fruitpies/rhubarbpiesmall.jpg"},
                new Pie {PieId = 4, Name="Pumpkin Pie", Price=12.95M, ShortDescription="Lorem Ipsum", LongDescription="Icing carrot cake jelly-o cheesecake. Sweet roll marzipan marshmallow toffee brownie brownie candy tootsie roll. Chocolate cake gingerbread tootsie roll oat cake pie chocolate bar cookie dragée brownie. Lollipop cotton candy cake bear claw oat cake. Dragée candy canes dessert tart. Marzipan dragée gummies lollipop jujubes chocolate bar candy canes. Icing gingerbread chupa chups cotton candy cookie sweet icing bonbon gummies. Gummies lollipop brownie biscuit danish chocolate cake. Danish powder cookie macaroon chocolate donut tart. Carrot cake dragée croissant lemon drops liquorice lemon drops cookie lollipop toffee. Carrot cake carrot cake liquorice sugar plum topping bonbon pie muffin jujubes. Jelly pastry wafer tart caramels bear claw. Tiramisu tart pie cake danish lemon drops. Brownie cupcake dragée gummies.", Category = _categoryRepository.AllCategories.ToList()[2],ImageUrl="https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/seasonal/pumpkinpie.jpg", InStock=true, IsPieOfTheWeek=true, ImageThumbnailUrl="https://gillcleerenpluralsight.blob.core.windows.net/files/bethanyspieshop/seasonal/pumpkinpiesmall.jpg"}
            };

        public IEnumerable<Pie> PiesOfTheWeek
        {
            get
            {
                return AllPies.Where(p => p.IsPieOfTheWeek);
            }
        }

        public Pie? GetPieById(int pieId) => AllPies.FirstOrDefault(p => p.PieId == pieId);

        public IEnumerable<Pie> SearchPies(string searchQuery)
        {
            throw new NotImplementedException();
        }
    }


. Acrescente as linhas abaixo na classe "Program.cs":

    using bethanysPieShop.Models;           // Linha inserida

    var builder = WebApplication.CreateBuilder(args);

    builder.Services.AddScoped<ICategoryRepository, MockCategoryRepository>();      // Linha inserida
    builder.Services.AddScoped<IPieRepository, MockPieRepository>();                // Linha inserida
    ...            


. Crie a pasta "Controllers" e dentro dela a classe abaixo:

    using bethanysPieShop.Models;
    using Microsoft.AspNetCore.Mvc;

    namespace bethanysPieShop.Controllers;

    public class PieController : Controller
    {

        private readonly IPieRepository _pieRepository;
        private readonly ICategoryRepository _categoryRepository;

        public PieController(IPieRepository pieRepository,
                                ICategoryRepository categoryRepository)
        {
            _pieRepository = pieRepository;
            _categoryRepository = categoryRepository;
        }


        public IActionResult List()
        {
            return View(_pieRepository.AllPies);
        }
    }



. Crie a pasta "Views/Pie" e dentro dela a view abaixo com a extensão "cshtml" com o nome "List.cshtml":

    @model IEnumerable<bethanysPieShop.Models.Pie>

    <!DOCTYPE html>

    <html>

    <head>
        <meta name="viewport" content="width=device-width" />
        <title>Bethany´s Pie Shop</title>
    </head>

    <body>
        <h1>@ViewBag.CurrentCategory</h1>


        @foreach( var pie in Model )
        {
        <div>
            <h2>@pie.Name </h2>
            <h3>@pie.Price.ToString("c") </h3>
            <h4>@pie.Category.CategoryName </h4>
        </div>
        }

    </body>

    </html>

. Acrescente as linhas abaixo na classe "PieController":

    using Microsoft.AspNetCore.Mvc;

    namespace bethanysPieShop.Controllers;

    public class PieController: Controller
    {

        ...

        public IActionResult List()
        {
            ViewBag.CurrentCategory = "Cheese cakes";       // Linha inserida

            return View( _pieRepository.AllPies );
        }
    }


. Levante o projeto e execute a rota abaixo no navegador:

    https://localhost:[porta]/pie/list


. Crie a pasta "ViewModels" e dentro dela a classe "PieListViewModel.cs" como abaixo:

    using bethanysPieShop.Models;

    namespace bethanysPieShop.ViewModels;

    public class PieListViewModel
    {
        public IEnumerable<Pie> Pies { get; }

        public string? CurrentCategory { get; }

        public PieListViewModel(IEnumerable<Pie> pies, string? currentCategory)
        {
            Pies = pies;

            CurrentCategory = currentCategory;
        }
    }

. Altere o código do método "PieController.List" como abaixo:

    using bethanysPieShop.ViewModels;   // Linha inserida
    ...
    public IActionResult List()
    {
        // ViewBag.CurrentCategory = "Cheese cakes";       // Linha inserida

        // return View( _pieRepository.AllPies );

        PieListViewModel piesListViewModel = new PieListViewModel( _pieRepository.AllPies, "Cheese cakes");     // Linha inserida

        return View( piesListViewModel );           // Linha inserida
    }
    ...

. Altere a view "Views/Pie/List.cshml" como abaixo:

    @model bethanysPieShop.ViewModels.PieListViewModel      <!-- Linha alterada -->

    <!DOCTYPE html>

    <html>

    <head>
        <meta name="viewport" content="width=device-width" />
        <title>Bethany´s Pie Shop</title>
    </head>

    <body>
        <h1>@Model.CurrentCategory</h1>         <!-- Linha alterada -->


        @foreach( var pie in Model.Pies )       <!-- Linha alterada -->
        {
        <div>
            <h2>@pie.Name </h2>
            <h3>@pie.Price.ToString("c") </h3>
            <h4>@pie.Category.CategoryName </h4>
        </div>
        }

    </body>

    </html>



